<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Andy Glew">
<title>Ri5 CMOs proposal: Cache Management Operations</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Ri5 CMOs proposal: Cache Management Operations</h1>
<div class="details">
<span id="author" class="author">Andy Glew</span><br>
<span id="email" class="email"><a href="mailto:andy.glew@sifive.com">andy.glew@sifive.com</a></span><br>
<span id="revnumber">version 0.1: Fixed Block Prefetches + CMOs,</span>
<span id="revdate">+ Privilege for CMOs...</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>Top level last modified</strong>: 2020-05-14 11:39:00 -0700 - top level (TBD: included subdocuments). See <a href="#_techpubs_information">Techpubs Information</a> section below for more details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about_this_document">About this document</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document is a proposal for cache management operations for RISC-V.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="">.</h2>
<div class="sectionbody">
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_about_this_document">About this document</a></li>
<li><a href="#">.</a></li>
<li><a href="#_fixed_block_size_prefetches_and_cmos">1. Fixed Block Size Prefetches and CMOs</a>
<ul class="sectlevel2">
<li><a href="#_summary_fixed_block_size_prefetches_and_cmos">1.1. SUMMARY: Fixed Block Size Prefetches and CMOs</a>
<ul class="sectlevel3">
<li><a href="#_fixed_block_size_prefetches">1.1.1. Fixed Block Size Prefetches</a></li>
<li><a href="#_fixed_block_size_clean_and_flush_cmos">1.1.2. Fixed Block Size Clean and Flush CMOs</a></li>
</ul>
</li>
<li><a href="#_details">1.2. DETAILS</a>
<ul class="sectlevel3">
<li><a href="#_the_usual_details">1.2.1. The Usual Details</a></li>
<li><a href="#_rationale">1.2.2. Rationale</a>
<ul class="sectlevel4">
<li><a href="#_addressing_modes">Addressing Modes</a></li>
<li><a href="#_fixed_minimum_block_size_not_cache_line_size">Fixed minimum block size - NOT cache line size</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_variable_address_range_cmos">2. Variable Address Range CMOs</a>
<ul class="sectlevel2">
<li><a href="#_summary_variable_address_range_cmos">2.1. SUMMARY: Variable Address Range CMOs</a>
<ul class="sectlevel3">
<li><a href="#_range_specification">2.1.1. Range specification</a></li>
<li><a href="#_return_value_rd">2.1.2. Return value RD</a></li>
<li><a href="#_cmo_type_cmo_specifier">2.1.3. CMO type .&lt;cmo-specifier&gt;</a></li>
</ul>
</li>
<li><a href="#_details_2">2.2. DETAILS</a>
<ul class="sectlevel3">
<li><a href="#_range_definition_rs1lwbrs2upb">2.2.1. Range Definition [RS1:lwb,RS2:upb)</a></li>
<li><a href="#_possible_implementations_ranging_from_cache_line_at_a_time_to_full_address_range">2.2.2. Possible implementations ranging from cache line at a time to full address range</a>
<ul class="sectlevel4">
<li><a href="#_sourcedest_to_support_exception_transparency">[[Source/dest]] to support [[exception transparency]]</a></li>
<li><a href="#_loop_to_support_cacheline_at_a_time_implementations">Loop to support cacheline at a time implementations</a></li>
<li><a href="#_rationale_variable_address_range_cmo_loop_construct">RATIONALE: Variable Address Range CMO loop construct</a></li>
</ul>
</li>
<li><a href="#_exceptions">2.2.3. Exceptions</a></li>
<li><a href="#_ecc_and_other_machine_check_exceptions_during_cmos">2.2.4. ECC and other machine check exceptions during CMOs</a></li>
<li><a href="#_permissions_for_cmos">2.2.5. Permissions for CMOs</a>
<ul class="sectlevel4">
<li><a href="#_memory_address_based_permissions_for_cmos">Memory address based permissions for CMOs</a></li>
<li><a href="#_permissions_by_cmo_type">Permissions by CMO type</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_microarchitecture_structure_range_cmos">3. Microarchitecture Structure Range CMOs</a>
<ul class="sectlevel2">
<li><a href="#_summary_microarchitecture_structure_range_cmos">3.1. SUMMARY: Microarchitecture Structure Range CMOs</a></li>
<li><a href="#_details_3">3.2. DETAILS</a>
<ul class="sectlevel3">
<li><a href="#_microarchitecture_entry_range_countdown">3.2.1. Microarchitecture Entry Range - countdown</a></li>
<li><a href="#_advisory_vs_mandatory_cmos">3.2.2. [[Advisory vs Mandatory CMOs]]</a></li>
<li><a href="#_possible_implementations_ranging_from_cache_line_at_a_time_to_whole_cache">3.2.3. Possible implementations ranging from cache line at a time to whole cache</a>
<ul class="sectlevel4">
<li><a href="#_sourcedest_to_support_exception_transparency_2">[[Source/dest]] to support [[exception transparency]]</a></li>
<li><a href="#_discussion">Discussion</a></li>
</ul>
</li>
<li><a href="#_exceptions_2">3.2.4. Exceptions</a></li>
<li><a href="#_ecc_and_other_machine_check_exceptions_during_cmos_2">3.2.5. ECC and other machine check exceptions during CMOs</a></li>
<li><a href="#_permissions_for_cmos_2">3.2.6. Permissions for CMOs</a>
<ul class="sectlevel4">
<li><a href="#_memory_address_based_permissions_for_cmos_2">Memory address based permissions for CMOs</a></li>
<li><a href="#_permissions_by_cmo_type_2">[[Permissions by CMO type]]</a></li>
</ul>
</li>
<li><a href="#_multiple_caches_and_cmo_ur">3.2.7. Multiple Caches and CMO.UR</a></li>
</ul>
</li>
<li><a href="#_cmo_descriptor_what_is_affected">3.3. [[CMO descriptor]] - what is affected</a></li>
<li><a href="#_cmo_ur_index">3.4. [[CMO UR index]]</a>
<ul class="sectlevel3">
<li><a href="#_traditional_microarchitecture_cache_invalidation_loops_in_the_past">3.4.1. Traditional microarchitecture cache invalidation loops in the past</a></li>
<li><a href="#_cmo_ur_abstracts_and_unifies_microarchitecture_cache_invalidation_loops">3.4.2. CMO.UR abstracts and unifies microarchitecture cache invalidation loops</a></li>
</ul>
</li>
<li><a href="#_cmo_ur_indexes_should_not_be_created_out_of_thin_air">3.5. CMO UR indexes should not be created out of thin air</a></li>
<li><a href="#_errors_during_cmo_ur">3.6. Errors during CMO.UR</a></li>
</ul>
</li>
<li><a href="#_privilege_for_cmos">4. Privilege for CMOs</a>
<ul class="sectlevel2">
<li><a href="#_summary_privilege_for_cmos_and_prefetches">4.1. SUMMARY: Privilege for CMOs and Prefetches</a></li>
<li><a href="#_rationale_privilege_for_cmos_and_prefetches">4.2. RATIONALE: Privilege for CMOs and Prefetches</a></li>
</ul>
</li>
<li><a href="#_2">.</a></li>
<li><a href="#_techpubs_information">Appendix A: Techpubs Information</a></li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fixed_block_size_prefetches_and_cmos">1. Fixed Block Size Prefetches and CMOs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_summary_fixed_block_size_prefetches_and_cmos">1.1. SUMMARY: Fixed Block Size Prefetches and CMOs</h3>
<div class="sect3">
<h4 id="_fixed_block_size_prefetches">1.1.1. Fixed Block Size Prefetches</h4>
<div class="paragraph">
<p>Proposed name: PREFETCH.64B.R</p>
</div>
<div class="ulist">
<ul>
<li>
<p>encoding: ORI with RD=R0, i.e. M[rs1+offset12]</p>
<div class="ulist">
<ul>
<li>
<p>imm12.rs1:5.110.rd=00000.0010011</p>
</li>
</ul>
</div>
</li>
<li>
<p>affects cache line containing virtual address M[rs1+offset12]</p>
</li>
<li>
<p>see [[Mnemonics and Names]] for a discussion of proposed mnemonics and names</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Proposed name: PREFETCH.64B.W [^mnemonics]</p>
</div>
<div class="ulist">
<ul>
<li>
<p>encoding: ANDI with RD=R0, i.e. M[rs1+offset12]</p>
<div class="ulist">
<ul>
<li>
<p>imm12.rs1:5.110.rd=00000.0110011</p>
</li>
</ul>
</div>
</li>
<li>
<p>affects cache line containing virtual address M[rs1+offset12]</p>
</li>
<li>
<p>see [[Mnemonics and Names]] for a discussion of proposed mnemonics and names</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_fixed_block_size_clean_and_flush_cmos">1.1.2. Fixed Block Size Clean and Flush CMOs</h4>
<div class="paragraph">
<p>Proposed name: CMO.64B.CLEAN.toL2</p>
</div>
<div class="ulist">
<ul>
<li>
<p>more descriptive name: D1-Clean-to-L2 64B</p>
</li>
<li>
<p>OR format with RD=R0, RS2=R0</p>
<div class="ulist">
<ul>
<li>
<p>funct7=0000000.rs2=00000.rs1:5.110.rd=00000.0110011</p>
</li>
</ul>
</div>
</li>
<li>
<p>affects cache line containing virtual address M[rs1]</p>
</li>
<li>
<p>"clean"</p>
<div class="ulist">
<ul>
<li>
<p>write dirty back,</p>
</li>
<li>
<p>keep clean copy of all lines in cache, both originally dirty and clean</p>
</li>
</ul>
</div>
</li>
<li>
<p>see [[Mnemonics and Names]] for a discussion of proposed mnemonics and names</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Proposed name: CMO.64B.FLUSH.toL2</p>
</div>
<div class="ulist">
<ul>
<li>
<p>more descriptive name: D1-Flush-to-L2 64B</p>
</li>
<li>
<p>encoding: AND format with RD=R0, RS2=R0</p>
<div class="ulist">
<ul>
<li>
<p>funct7=0000000.rs2=00000.rs1:5.111.rd=00000.0110011</p>
</li>
</ul>
</div>
</li>
<li>
<p>affects cache line containing virtual address M[rs1]</p>
</li>
<li>
<p>"flush"</p>
<div class="ulist">
<ul>
<li>
<p>write dirty back,</p>
</li>
<li>
<p>invalidate all lines in cache, both originally dirty and clean</p>
</li>
</ul>
</div>
</li>
<li>
<p>see [[Mnemonics and Names]] for a discussion of proposed mnemonics and names</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The more descriptive names "D1-Clean-to-L2" and "D1-Flush-to-L2" are more descriptive of the implementation &amp; intent on a typical system at the time this is being written. The proposed names such as CMO.64B.FLUSH.toL2 are more generic, and may apply when the cache hierarchy is different. (Obviously "toL2" is microarchitecture specific, and should be replaced by something like "SHARED-LEVEL".) See [[Mnemonics and Names]] for a discussion of proposed mnemonics and names.</p>
</div>
<div class="paragraph">
<p>The intent is that dirty data be flushed to some cache level common or shared between all or most processors of interest. E.g. if all processors share the L2, flush their L1s to the L2. If all processors share and L3, then flush their L1s and L2s to the L3. And so on. Obviously, exactly what level flushes done to depends on the cache hierarchy and platform.</p>
</div>
<div class="paragraph">
<p>(More precise control is found in the variable address range CMOs. We do not want to spend all of the increasingly scarce instruction encodings to encode all hypothetically desirable prefetches and CMOs in the instruction format that touches Mem[reg+imm12]. Some other instructions use register operands to allow more prefetch and CMO types.)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_details">1.2. DETAILS</h3>
<div class="sect3">
<h4 id="_the_usual_details">1.2.1. The Usual Details</h4>
<div class="ulist">
<ul>
<li>
<p>Page Fault: NOT taken for PREFETCH</p>
<div class="ulist">
<ul>
<li>
<p>The intent is that loops may access data right up to a page boundary beyond which they are not allowed, and may contain prefetches that are an arbitrary stride past the current ordinary memory access. Therefore, such address range prefetches should be ignored.</p>
<div class="ulist">
<ul>
<li>
<p>&#8658; Not useful for initiating virtual memory swaps from disk, copy-on-write, and prefetches in some "Two Level Memory" systems, e.g. with NVRAM, etc., which may involve OS page table management in a deferred manner. (TBD: link to paper (CW))</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Page Fault: NOT taken for CMO.CLEAN/FLUSH</p>
<div class="ulist">
<ul>
<li>
<p>again, the intent is that the CMOs defined on this page may be treated as NOPs or hints by an implementation. I.e. they are for performance only.</p>
</li>
<li>
<p>Note that this implies that these CMOs /may/ not be suitable for cache flushing related to software consistency or persistence.</p>
<div class="ulist">
<ul>
<li>
<p>Some OSs treat the hardware page tables as a cache for a larger data structure that translates virtual to physical memory address translation</p>
</li>
<li>
<p>This means that physical addresses in the cache may be present even the translations from their virtual address those physical addresses are no longer present in the page tables. In such a situation a true guaranteed flush might require taking page faults.</p>
</li>
<li>
<p>Obviously this is OS specific. Software with knowledge of the OS behavior may use these instructions for guaranteed flushes. However, it is not possible for the instruction set architecture to make this guarantee.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Debug exceptions, e.g. data address breakpoints: YES taken.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that page table protections are sometimes used as part of a debugging strategy. Therefore, ignoring page table faults is inconsistent with permitting debug exceptions</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ECC and other machine check exceptions: taken?</p>
<div class="ulist">
<ul>
<li>
<p>In the interest of finding bugs earlier.</p>
</li>
<li>
<p>Although this is somewhat incompatible with allowing these prefetches and CMOs to become NOPs</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_rationale">1.2.2. Rationale</h4>
<div class="sect4">
<h5 id="_addressing_modes">Addressing Modes</h5>
<div class="paragraph">
<p>Want full addressing mode for fixed block size prefetches, <code>Reg+Offset</code>, so that compiler can just add a prefetch stride rto the offset, doesn&#8217;t neeed to allocate extra registers for the prefedtch address</p>
</div>
<div class="paragraph">
<p>CMO clean/flushes with full Offset addressing mode would be nice to have, but consumes encoding space.</p>
</div>
</div>
<div class="sect4">
<h5 id="_fixed_minimum_block_size_not_cache_line_size">Fixed minimum block size - NOT cache line size</h5>
<div class="paragraph">
<p>These instructions are associated with a fixed block
size - actually a minimum fixed block size. NOT the microarchitecture
specific cache line size.</p>
</div>
<div class="paragraph">
<p>Currently the fixed block size is only defined to be 64 bytes.
Instruction encodings are reserves for other block sizes, e.g. 256
bytes. However, there is unlikely to be room to support all possible
cache line sizes in these instructions.</p>
</div>
<div class="paragraph">
<p>The fixed block size of these instructions is NOT a cache line
size. The intention is to hide the microarchitecture cache line size,
which may even be different on different cache levels in the same
machine, while allowing reasonably good performance across machines
with different cache line sizes.</p>
</div>
<div class="paragraph">
<p>The fixed minimum block size (FSZ) is essentially a contract that
tells software that it does not need to prefetch more often than that
size.  Implementations are permitted to "round up" FSZ: e.g. on a
machine with 256 byte cache lines, each PREFETCH.64B.[RW] and
CMO.64B.{CLEAN,FLUSH} may apply to an entire 256 byte cache
line. Conversely, on a machine with 32 byte cache lines, it is
recommended that implementations of these instructions to address A
apply similar operations to cache lines containing address A and
A+32. "It is recommended" because it is permissible for all of these
operations defined on this page to be ignored, treated as NOPs or
hints.</p>
</div>
<div class="paragraph">
<p>The intent of the fixed minimum block size is to set an upper bound on
prefetch instruction overhead. E.g. if standing an array of 32 byte
items <code>LOOP A[i] ENDLOOP</code>, one might prefetch at every iteration of
the loop <code>LOOP A[i]; prefetch A[i+delta] ENDLOOP</code>. However, prefetch
instruction overhead often outweighs the memory latency benefit of
prefetch instructions. If one knows that the cache line size is 256
bytes, i.e. once every 256/4=64 iterations of the loop, one might
unroll the loop 64 times <code>LOOP A[i+0]; &#8230;&#8203; A[i+63]; prefetch
A[i+63+delta] ENDLOOP</code>, thereby reducing the prefetch instruction
overhead to 1/64.  But if the cache line size is 64 bytes you only
need to enroll 64/4=16 times: <code>LOOP A[i+0]; &#8230;&#8203; A[i+15]; prefetch
A[i+15+delta] ENDLOOP</code>.  The prefetches are relatively more important,
but the overhead of unrolling code to exactly match the line size is
greatly reduced.</p>
</div>
<div class="paragraph">
<p>The fixed minimum block size is an indication that the user does not
need to place prefetches any closer together to get the benefit of
prefetching all of a contiguous memory region.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_variable_address_range_cmos">2. Variable Address Range CMOs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Traditional CMOs are performed a cache line at a time, in a loop.
This exposes the cache line size,
and inhibits performance for some implementations.</p>
</div>
<div class="paragraph">
<p>Some use cases require or prefer CMOs that apply to a set of memory addresses, typically a contiguous range.
Furthermore, address ranges permit optimizations that perform better on some implementations than looping a cache line at a time.</p>
</div>
<div class="paragraph">
<p>This proposal defines the instruction in such a way that allows <a href="#_possible_implementations_ranging_from_cache_line_at_a_time_to_full_address_range">Possible implementations ranging from cache line at a time to full address range</a>,
with a loop such as that below</p>
</div>
<div class="paragraph">
<p>In pseudocode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>x11 := lwb
x12 := upb (= lwb + size_in_bytes)
LOOP
   CMO.VAX.&lt;&gt; x11,x11,x12
UNTIL x1 ==x12</pre>
</div>
</div>
<div class="paragraph">
<p>In assembly code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    x11 := lwb
    x12 := upb
L:  CMO.VAX.&lt;&gt; x11,x11,x12
    bne x11,x12,L</pre>
</div>
</div>
<div class="paragraph">
<p>See below, <a href="#_possible_implementations_ranging_from_cache_line_at_a_time_to_full_address_range">Possible implementations ranging from cache line at a time to full address range</a>,
for more details.</p>
</div>
<div class="sect2">
<h3 id="_summary_variable_address_range_cmos">2.1. SUMMARY: Variable Address Range CMOs</h3>
<div class="paragraph">
<p>Proposed name: CMO.VAR.&lt;cmo-specifier&gt;</p>
</div>
<div class="paragraph">
<p>Encoding: R-format</p>
</div>
<div class="ulist">
<ul>
<li>
<p>R-format: 3 registers: RD, RS1, RS2</p>
<div class="ulist">
<ul>
<li>
<p>Register numbers in RD and RS1 are required to be the same</p>
<div class="ulist">
<ul>
<li>
<p>If the register numbers in RD and RS1 are not the same an illegal instruction exception is raised
(unless such encodings have been reused for other instructions in the future).</p>
</li>
<li>
<p>The term RD/RS1 will refer to this register number</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>numeric encoding: TBD</p>
<div class="ulist">
<ul>
<li>
<p>2 funct7 encodings &#8658; 256 possible &lt;cmo-specifiers&gt;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assembly Syntax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CMO.VAR.&lt;cmo-specifier&gt; rd,rs1,rs2</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But, since register numbers in RD and RS1 are required to be the same, assemblers may choose to provide the two register operand version</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CMO.VAR.&lt;cmo-specifier&gt; rd_and_rs1,rs2</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Operands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Input:</p>
<div class="ulist">
<ul>
<li>
<p>memory address range:</p>
<div class="ulist">
<ul>
<li>
<p>RS1 (RD/RS1) contains <code>lwb</code>, the lower bound, the address at which the CMO will start</p>
</li>
<li>
<p>RS2 contains <code>upb</code>, the upper bound of the range</p>
</li>
</ul>
</div>
</li>
<li>
<p>type of operation</p>
<div class="ulist">
<ul>
<li>
<p>.[[&lt;cmo-specifier&gt;]]: i.e. specified by the encoding of the particular CMO.VAR instruction</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Output</p>
<div class="ulist">
<ul>
<li>
<p>RD (RSD/RS1) contains <code>stop_address</code>, the memory address at which the CMO operation stopped</p>
<div class="ulist">
<ul>
<li>
<p>if RD = RS2:`upb`, the operation was completed</p>
</li>
</ul>
</div>
</li>
<li>
<p>if RD = RS1:`lwb`, the operation stopped immediately, e.g. an exception such as a page fault or a data address breakpoint at lwb</p>
</li>
<li>
<p>if <code>lwb</code> &lt; RD &lt; <code>upb</code>, the operation has been partially completed</p>
<div class="ulist">
<ul>
<li>
<p>e.g. at an exception</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_range_specification">2.1.1. Range specification</h4>
<div class="paragraph">
<p>The CMO is applied to the range [RS1,RS2), i.e. to all memory addresses A such that RS1 &lt;= A &lt; RS2.
Not that the upper bound <code>upb</code> is exclusive, one past the end of the region.
This allows the calculation <code>upb=lwb+size_in_bytes</code>.</p>
</div>
<div class="paragraph">
<p>Pedantically, the range is all memory addresses <code>A</code> such that <code>0 &#8656; A  &lt; upb-lwb</code>.
This permits wrapping around the address space.
To specify a range that reaches the maximum possible (unsigned) address, specify <code>upb=0</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_return_value_rd">2.1.2. Return value RD</h4>
<div class="paragraph">
<p>This instruction family is [[restartable after partial completion]]. E.g. on an exception such as a page fault or debug address breakpoint the output register RD is set to the data address of the exception,
and since the instruction is [[source/dest]], with the register numbers in RD and RS1 required to be the same, returning from the exception to the CMO.VAR instruction will pick up execution where it left off.</p>
</div>
<div class="paragraph">
<p>Similarly, implementations may only process part of the range specified by [RS1,RS2), e.g. only the 1st cache line, setting RD to an address <em>within</em> the next cache line, typically the start,
Software using this instruction is required to wrap it in a loop to process the entire range.</p>
</div>
<div class="paragraph">
<p>See <a href="#_loop_to_support_cacheline_at_a_time_implementations">Loop to support cacheline at a time implementations</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cmo_type_cmo_specifier">2.1.3. CMO type .&lt;cmo-specifier&gt;</h4>
<div class="paragraph">
<p>The .&lt;cmo-specifier&gt; is derived from the instruction encoding.
This proposal asks for a total of 256 .&lt;cmo-specifiers&gt;, two funct7 R-format encoding groups.</p>
</div>
<div class="paragraph">
<p>The .&lt;cmo-specifier&gt; derived from the instruction encoding specifies operations such as</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CLEAN (write back dirty data, leaving clean data in cache)</p>
</li>
<li>
<p>FLUSH (writeback dirty data, leaving invalid data in cache)
and other operations, as well as the caches involved. See [[CMO (Cache Management Operation) Types]].
(TBD: I expect that one or more of the .&lt;cmo-specifier&gt; will be something like a number identifying a group of CSRs loaded with an extended CMO type specification.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In assembly code certain CMO specifiers will be hardlined, and others may be indicated by the group number:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CMO.VAR.CLEAN</p>
</li>
<li>
<p>CMO.VAR.FLUSH</p>
</li>
<li>
<p>CMO.VAR.0</p>
</li>
<li>
<p>CMO.VAR.1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TBD: full list of CMOs .&lt;cmo-specifiers&gt; is in a spreadsheet.
TBD: include here.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_details_2">2.2. DETAILS</h3>
<div class="sect3">
<h4 id="_range_definition_rs1lwbrs2upb">2.2.1. Range Definition [RS1:lwb,RS2:upb)</h4>
<div class="paragraph">
<p>The CMO is applied to the range [RS1,RS2), i.e. to all memory addresses A such that RS1 &lt;= A &lt; RS2.
Not that the upper bound <code>upb</code> is exclusive, one past the end of the region.
This allows the calculation <code>upb=lwb+size_in_bytes</code>.</p>
</div>
<div class="paragraph">
<p>Pedantically, the range is all memory addresses <code>A</code> such that <code>0 &#8656; A  &lt; upb-lwb</code>.
This permits wrapping around the address space.
To specify a range that reaches the maximum possible address, spercify <code>upb=0</code>.</p>
</div>
<div class="paragraph">
<p>CMOs (Cache Maintenance Operations) operate on <a id="NAPOT"></a> memory blocks such as cache lines, e.g. 64B, that are  implementation specific, and which may be different for different caches in the system.</p>
</div>
<div class="paragraph">
<p>CMO.VAR is defined to always apply to at least such memory block, even if RS1 &gt;= RS2.</p>
</div>
<div class="paragraph">
<p>The range&#8217;s upper and lower bounds, RS1:<code>lwb</code> and <code>upb</code> are <em>not</em> required to be aligned to the relevant block size.
Therefore RS1:<code>lwb</code> is an address <em>within</em> the first memory block to which the operation will apply.
Similarly, <code>upb</code>, the highest address in the range specified by the user, may lie within such a memory block, so the operation may include and apply beyond <code>upb</code> to the next block boundary.</p>
</div>
<div class="paragraph">
<p>As described in [[Advisory vs Mandatory CMOs]]:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some CMOs are optional or advisory: they may or may not be performed,</p>
<div class="ulist">
<ul>
<li>
<p>Such advisory CMOs may be performed beyond the range [<code>lwb</code>,<code>upb</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>However, some CMOs are mandatory, and may affect the values observed by [[timing independent code]].</p>
<div class="ulist">
<ul>
<li>
<p>if <code>upb</code> lies in a memory block that does not overlap any of the blocks in [<code>lwb</code>,<code>upb</code>)
then the implementation must guarantee that the mandatory or destructive CML has not been applied to the memory block starting at address <code>upb</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Security timing channel related CMOs are mandatory but do not affect the values observed by [[timing independent code]].
TBD: are such CMOs required not to apply beyond the [[address range rounded to block granularity]]?
POR: it is permitted for any non-value changing operations to apply beyond the range.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
there is much disagreement with respect to terminology,
whether operations that directly affect values (such as [[DISCARD cache line]])
are to be considered CMOs at all, or whether they might be
specified by the CMO instructions such as CMO.VAR.
For the purposes of this discussion we will assume that they could be specified by these
instructions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_possible_implementations_ranging_from_cache_line_at_a_time_to_full_address_range">2.2.2. Possible implementations ranging from cache line at a time to full address range</h4>
<div class="paragraph">
<p>The CMO.VAR instruction family permits implementations that include</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>operating a cache line at a time</p>
</li>
<li>
<p>trapping and emulating (e.g. in M-mode)</p>
</li>
<li>
<p>HW state machines that can operate on the full range</p>
<div class="ulist">
<ul>
<li>
<p>albeit stopping at the first page fault or exception.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>First: Cache line at a time implementations are typical of many other ISAs, RISC and otherwise.</p>
</div>
<div class="paragraph">
<p>Second: On some implementations the actual cache management interface is
non-standard, e.g. containing sequences of CSRs or MMIO accesses to control
external caches. Such implementations may trap the CMO instruction,
and emulate it using the idiosyncratic mechanisms.
Such trap and emulation would have a high-performance cost if performed a cache line at a time.
Hence, the address range semantics, permitting the trap ciost to b e amortized.</p>
</div>
<div class="paragraph">
<p>Third: While hardware state machines have some advantages, it is not
acceptable to block interrupts for a long time while cache flushes are
applied to every cache line in address range. Furthermore, address range CMOs
may be subject to address related exceptions such as page-faults and debug breakpoints.</p>
</div>
<div class="sect4">
<h5 id="_sourcedest_to_support_exception_transparency">[[Source/dest]] to support [[exception transparency]]</h5>
<div class="paragraph">
<p>This instruction family is [[restartable after partial completion]]. E.g. on an exception such as a page fault or debug address breakpoint the output register RD is set to the data address of the exception,
and since the instruction is [[source/dest]], with the register numbers in RD and RS1 required to be the same, returning from the exception to the CMO.VAR instruction will pick up execution where it left off.</p>
</div>
<div class="paragraph">
<p>RATIONALE: This proposal has chosen to implement [[source/dest]] by requiring separate register fields RD and RS1 to contain the same value. An alternative was to make register field RD both an input and an output, allowing RS1 and RS2 to be used for other inputs. Separate RD=RS1 source/dest is more natural for a RISC instruction decoder, and detecting RD=RS1 has already been performed for other RISC-V instructions, e.g. in the V extension. However separate RD=RS1 "wastes" instruction encodings by making RD!=RS1 illegal,, and leaves no register free for any 3rd operand such as the CMO type, hence requiring .&lt;cmo-specifier&gt; in the instruction encoding.</p>
</div>
</div>
<div class="sect4">
<h5 id="_loop_to_support_cacheline_at_a_time_implementations">Loop to support cacheline at a time implementations</h5>
<div class="paragraph">
<p>The CMO.VAR instruction is intended to be used in a software loop such as that below</p>
</div>
<div class="paragraph">
<p>In pseudocode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>x11 := lwb
x12 := upb
LOOP
   CMO.VAX.&lt;&gt; x11,x11,x12
UNTIL x1 ==x12</pre>
</div>
</div>
<div class="paragraph">
<p>In assembly code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    x11 := lwb
    x12 := upb
L:  CMO.VAX.&lt;&gt; x11,x11,x12
    bne x11,x12,L</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the closing comparison BNE is exact.
The CMO.VR instruction is required to return the exact upper bound when it terminates</p>
</div>
<div class="paragraph">
<p>RATIONALE: returning the exact upper bound rather than an address in a cache block containing or just past the upper bound,
allows the exact comparison BNE in the reference loop, and hence permits the exclusive range to apply right up to last address, and to wrap,
at the cost of a more complicated address computation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rationale_variable_address_range_cmo_loop_construct">RATIONALE: Variable Address Range CMO loop construct</h5>
<div class="paragraph">
<p>The software loop around the CMO range instructions is required only to support cache line at a time implementations.
If this proposal only wanted to support hardware state machines or trap and emulate, the software loop would not be needed.</p>
</div>
<div class="paragraph">
<p>Similarly, the upper bound operand RS2:<code>upb?</code>, is only required to support address range aware implementations,
such as trap and emulate or hardware state machines.
Cache line at a time implementations may ignore the RS2 operand.
Therefore, the operation is always applied to at least one memory address.</p>
</div>
<div class="paragraph">
<p>To guarantee that the loop wrapped around the CMO range instructions makes forward progress
in the absence of an exception the value output to RD must always be greater than the value input from RS1,
recalling that register numbers RD and RS1 are required to be the same.
(On an exception output RD may be unchanged from input RS1.)</p>
</div>
<div class="paragraph">
<p>Typically, the output value RD will be the start address of the next cache block.</p>
</div>
<div class="paragraph">
<p>To guarantee that the loop terminates, on the final iteration the output value RD must be equal to RS2.</p>
</div>
<div class="paragraph">
<p>In other words
<sub>~</sub>~
IF rs1 &amp;&amp; rs2 are in the same cache line
   perform CMO for cache line containing rs1 IF not at beginning of cache line
   rd := rs2
ELSE
   perform CMO for cache line containing rs1
   rd := (rs1 + CL_SIZE) &amp; ((1&lt;&lt;CL_SIZE)-1)
<sub>~</sub>~</p>
</div>
<div class="paragraph">
<p>Although some CMOs may be optional or advisory, that refers to their effect upon memory or cache.
The range oriented CMOs like CMO.VAR cannot simply be made into NOPs, because the loops above would never terminate.
The cache management operation may be dropped or ignored,
but RD must always be set to guarantee that the loop will make eventually terminate,</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exceptions">2.2.3. Exceptions</h4>
<div class="ulist">
<ul>
<li>
<p>Illegal Instruction Exceptions: taken, if the CMO.VAR.&lt;cmo-specifier&gt; is not supported.</p>
</li>
<li>
<p>Permission Exception: for CMO not permitted</p>
<div class="ulist">
<ul>
<li>
<p>Certain CMO (Cache Management Operayions) may be permitted to a high privilege level such as M-mode, but may be forbidden to lower privilege lebels such as S-mode or U-mode.</p>
</li>
<li>
<p>TBD: exactly how this is reported. Probably like a read/write permission exception. Possibly requiring a new exception because identifier</p>
</li>
</ul>
</div>
</li>
<li>
<p>Page Faults: taken</p>
</li>
<li>
<p>Other memory permissions exceptions (e.g. PMP violations): taken</p>
</li>
<li>
<p>Debug exceptions, e.g. data address breakpoints: taken.</p>
</li>
<li>
<p>ECC and other machine checks: taken or logged</p>
<div class="ulist">
<ul>
<li>
<p>see below</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ecc_and_other_machine_check_exceptions_during_cmos">2.2.4. ECC and other machine check exceptions during CMOs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
the term "machine check" refers to an error reporting mechanism for errors such as ECC or lockstep execution mismatches. TBD: determine and use the appropriate RISC-V terminology for "machine checks".
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Machine checks may be reported as exceptions or recorded in logging registers or counters without producing exceptions.</p>
</div>
<div class="paragraph">
<p>In general, machine checks should be reported if enabled and if an error is detected that might produce loss of data.
This consideration applies to CMOs: e.g. if a CMO tries to flush a dirty cache line that contains an uncorrectable error, a machine check should be reported.
However, an uncorrectable error in a clean cache line may be ignorable since it is about to be invalidated and will never be used in the future.</p>
</div>
<div class="paragraph">
<p>Similarly, a DISCARD cache line CMO may invalidate dirty cache line data without writing it back. In which case, even an uncorrectable error might be ignored, or might be reported without causing an exception.</p>
</div>
<div class="paragraph">
<p>Such machine check behavior is implementation dependent.</p>
</div>
</div>
<div class="sect3">
<h4 id="_permissions_for_cmos">2.2.5. Permissions for CMOs</h4>
<div class="sect4">
<h5 id="_memory_address_based_permissions_for_cmos">Memory address based permissions for CMOs</h5>
<div class="paragraph">
<p>The CMO.VAR.&lt;cmo-specifier&gt; instructions affect one or more memory addresses,
and therefore are subject to memory access permissions.</p>
</div>
<div class="paragraph">
<p>Most CMO (Cache Management Ops) require only read permission:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CLEAN (write out dirty data, leaving clean data in cache)</p>
</li>
<li>
<p>FLUSH (Write out dirty data, invalidate all lines)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even though "clean" and "flush" may seem to be like write operations, and the dirty data can only have occurred as result of write operations,
the dirty cache lines may have been written by a previous mode that shares memory with the current mode that has only read access.</p>
</div>
<div class="paragraph">
<p>The overall principal is, if software could have accomplished the same operation e.g. flushing dirty data or evicting lines, using ordinary loads and stores, then only read permissions are required.</p>
</div>
<div class="paragraph">
<p>If the operation is performed read permissions are required to all bytes in the range.</p>
</div>
<div class="paragraph">
<p>(If an optional or advisory operation is not performed, no read permissions checks or exceptions are required.)</p>
</div>
<div class="paragraph">
<p>Some CMOs affect values, and therefore require at least write permission:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ZALLOC (Allocate Zero Filled Cache Line without RFO)</p>
<div class="ulist">
<ul>
<li>
<p>e.g. IBM POWER DCBZ</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_permissions_by_cmo_type">Permissions by CMO type</h5>
<div class="paragraph">
<p>Some CMOs not only affect value, but might also affect the cache protocol and/or expose data from other privileged domains.
If implemented, these require privileges beyond those specified for memory addresses.
Such operations include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CLALLOC (Allocate Cache Line with neither RFO nor zero fill)</p>
<div class="ulist">
<ul>
<li>
<p>e.g. IBM POWER DCBA</p>
</li>
</ul>
</div>
</li>
<li>
<p>DISCARD cache line</p>
<div class="ulist">
<ul>
<li>
<p>discard dirty data without writing back</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similarly, while it might be possible for an ordinary user to arrange to flush a line out of a particular level of the cache hierarchy,
doing so with ordinary loads and stores might be a very slow process,
whereas doing so with a CMO instruction would be much more efficient, possibly leading to DOS (Denial of Service) attacks.
Therefore, even CMOs that might otherwise require only read permission
may be "modulated" by privileged software.</p>
</div>
<div class="paragraph">
<p>See section <a href="#_privilege_for_cmos">Privilege for CMOs</a>
which applies to both address range CMO.VAR.&lt;cmo-specifier&gt; and microarchitecture entry range CMO.UR.&lt;cmo-specifier&gt;
CMOs, as well as to [[Fixed Block Size CMOs]] and prefetches.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_microarchitecture_structure_range_cmos">3. Microarchitecture Structure Range CMOs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some situations require cache management operations that are NOT associated with a single address or an address range.</p>
</div>
<div class="paragraph">
<p>E.g. if an entire cache needs to be invalidated, it is inefficient to iterate over every possible address that might be in the cache.</p>
</div>
<div class="paragraph">
<p>Some traditional RISC ISAs instructions that invalidate by (set,way).
Problems with this include:
exposing microarchitecture details to code that might otherwise be portable,
inability to take advantage of hardware optimizations like bulk invalidates and state machines,
etc.</p>
</div>
<div class="paragraph">
<p>This proposal defines instructions in such a way that allows <a href="#_possible_implementations_ranging_from_cache_line_at_a_time_to_full_address_range">Possible implementations ranging from cache line at a time to full address range</a>,
with a loop such as that below:</p>
</div>
<div class="paragraph">
<p>The CMO.UR instruction is intended to be used in a software loop such as that below</p>
</div>
<div class="paragraph">
<p>In pseudocode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Possibly set up CMO type in CSR(s) specified by CMO.UR.&lt;&gt; instruction
x11 := x0
LOOP
   CMO.UR.&lt;&gt; x11,x11
UNTIL X11 &lt; 0</pre>
</div>
</div>
<div class="paragraph">
<p>In assembly code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    MOV x11,x0
L:  CMO.UR.&lt;&gt; x11,x11
    BGEZ x11,L</pre>
</div>
</div>
<div class="sect2">
<h3 id="_summary_microarchitecture_structure_range_cmos">3.1. SUMMARY: Microarchitecture Structure Range CMOs</h3>
<div class="paragraph">
<p>Proposed name: CMO.UR.&lt;cmo-specifier&gt;</p>
</div>
<div class="paragraph">
<p>Encoding: R-format</p>
</div>
<div class="ulist">
<ul>
<li>
<p>2 registers: RD, RS1</p>
<div class="ulist">
<ul>
<li>
<p>R format actually has three registers: unused register RS2 is required to be zero</p>
</li>
<li>
<p>Register numbers in RD and RS1 are required to be the same</p>
<div class="ulist">
<ul>
<li>
<p>Why?: restartability</p>
</li>
<li>
<p>If the register numbers in RD and RS1 are not the same an illegal instruction exception is raised
(unless such encodings have been reused for other instructions in the future).</p>
</li>
<li>
<p>The term RD/RS1 will refer to this register number</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assembly Syntax:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CMO.UR.&lt;cmo-specifier&gt; rd,rs1,x0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But, since register numbers in RD and RS1 are required to be the same, and RS2 is required X0, assemblers are encouraged to provide the single register operand version</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CMO.UR.&lt;cmo-specifier&gt; rd_and_rs1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Operands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Input:</p>
<div class="ulist">
<ul>
<li>
<p>memory address range:</p>
<div class="ulist">
<ul>
<li>
<p>RS1 (RD/RS1) contains <code>start_entry</code>, the [[microarchitecture entry number]] for the specified cache at which the CMO will start</p>
<div class="ulist">
<ul>
<li>
<p>RS1 = zero is the first entry</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>type of operation and caches to which it is applied</p>
<div class="ulist">
<ul>
<li>
<p>.[[&lt;cmo-specifier&gt;]]: i.e. specified by the encoding of the particular CMO.UR instruction</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Output</p>
<div class="ulist">
<ul>
<li>
<p>RD (RSD/RS1) contains <code>stop_entry</code>, the microarchitecture entry number at which the CMO operation stopped</p>
<div class="ulist">
<ul>
<li>
<p>if RD is negative the operation has completed</p>
<div class="ulist">
<ul>
<li>
<p>IF RD=-1 (all 1s unsigned, ~0) the operation completed successfully</p>
</li>
<li>
<p>Other negative values of RD are reserved</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This instruction family is [[restartable after partial completion]]. E.g. on and exception such as a [[machine check error]] or a debug address breakpoint the output register RD is to the microarchitecture entry number where the exception was incurred.
Since the instruction is [[source/dest]], with the register numbers in RD and RS1 required to be the same, returning from the exception to the CMO.UR instruction will pick up execution where it left off.</p>
</div>
<div class="paragraph">
<p>Similarly, implementations may only process part of the range specified by microarchitecture entry numbers [0,num_entries),
e.g. only the 1st cache line, setting RD/RS1 to an address <em>within</em> the next cache line.
Software using this instruction is required to wrap it in a loop to process the entire range.</p>
</div>
<div class="paragraph">
<p>The .&lt;cmo-specifier&gt; derived from the instruction encoding (not a general-purpose register operand) specifies operations such as</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CLEAN (write back dirty data, leaving clean data in cache)</p>
</li>
<li>
<p>FLUSH (writeback dirty data, leaving invalid data in cache)
and other operations, as well as the caches involved. See [[CMO (Cache Management Operation) Types]].
(TBD: I expect that one or more of the .&lt;cmo-specifier&gt; will be something like a number identifying a group of CSRs loaded with an extended CMO type specification.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In assembly code certain CMO specifiers will be hardlined, and others may be indicated by the group number:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CMO.UR.CLEAN</p>
</li>
<li>
<p>CMO.UR.FLUSH</p>
</li>
<li>
<p>CMO.UR.0</p>
</li>
<li>
<p>CMO.UR.1</p>
</li>
</ul>
</div>
<h5 id="_loops_to_support_cacheline_at_a_time_implementations" class="discrete">Loops to support cacheline at a time implementations</h5>
<div class="paragraph">
<p>The CMO.UR instruction is intended to be used in a software loop such as that below</p>
</div>
<div class="paragraph">
<p>In pseudocode:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Possibly set up CMO type in CSR(s) specified by CMO.UR.&lt;&gt; instruction
x11 := x0
LOOP
   CMO.UR.&lt;&gt; x11,x11
UNTIL X11 &lt; 0</pre>
</div>
</div>
<div class="paragraph">
<p>In assembly code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    MOV x11,x0
L:  CMO.UR.&lt;&gt; x11,x11
    BGEZ x11,L</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_details_3">3.2. DETAILS</h3>
<div class="sect3">
<h4 id="_microarchitecture_entry_range_countdown">3.2.1. Microarchitecture Entry Range - countdown</h4>
<div class="paragraph">
<p>When used in a loop such as <code>X11:= ~0; LOOP CMO.UR X1; UNTIL X11 &lt; 0</code>
the cache management operation is applied to a range of microarchitecture entry numbers
for the cache specified by the .<cmo-type>field of the CMO.UR instruction.</cmo-type></p>
</div>
<div class="paragraph">
<p>For the purposes of this instruction,
a cache has entries numbered from 0
extending to some maximum entry number.</p>
</div>
<div class="paragraph">
<p>The CMO.UR instructions avoid the need for the user to know or discover the number of lines in the cache,
by starting the iteration at the possible number (all set bits, i.e. -1 or ~0)
and modifying the index until &lt;0.
The implementation is therefore required to "skip" index numbers that are not valid.</p>
</div>
<div class="paragraph">
<p>Typical cache entries have have (set,way) coordinates.<br>
The microarchitecture entry number may be a simple transformation such as
<code>e = set*nways+way</code>
or <code>e = way*nsets+set</code>,
and the iteration may simply decrement by one for every cache line affected until the maximum number of entries  is reached.</p>
</div>
<div class="paragraph">
<p>Pseudocode for a simple CMO.UR instruction implementation might look like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  CMO.UR rd,rs1  // where register numbers rd and rs1 are required to be the same
       index := rs1 &amp; (CACHE_ENTRIES - 1)
perform CMO for cache entry #index
index := index-1</pre>
</div>
</div>
<div class="paragraph">
<p>Other recurrences for the index are possible.
All that is required is that the sequence begin with -1 and terminate with -1, with all intermediate values positive and no repetitions,
so that the reference CMO.UR loop loop is guaranteed to make forward progress and eventually terminate, after visiting all of the entries in the cache,
It is not required that the index be monotonically decreasing.</p>
</div>
<div class="paragraph">
<p>Indeed "twisting" the index sequence might be used to hide microarchitecture details and mitigate information leaks.
(The twisting might even be PC dependent.)</p>
</div>
<div class="paragraph">
<p>The sequence of indexes may contain values that do not map to actual cache lines, so long as those invalid mappings do not cause exceptions.
(E.g. [[Way Locking and CMO.UR]] or [[Multiple Caches and CMO.UR]].)
Such implementations should not, however, "waste too much time" on invalid entries.</p>
</div>
<div class="paragraph">
<p>Users should not assume or rely on a simple mapping of CMO.UR indexes to (set,way).
E.g. users should not assume that they can invalidatean entire of a 4-way set associative cache by stepping the index by -4
in a non-standard loop structure.</p>
</div>
</div>
<div class="sect3">
<h4 id="_advisory_vs_mandatory_cmos">3.2.2. [[Advisory vs Mandatory CMOs]]</h4>
<div class="paragraph">
<p>As described in [[Advisory vs Mandatory CMOs]]:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some CMOs are optional or advisory: they may or may not be performed,</p>
<div class="ulist">
<ul>
<li>
<p>Such advisory CMOs may be performed beyond the range of microarchitecture entry numbers specified</p>
</li>
</ul>
</div>
</li>
<li>
<p>However, some CMOs are mandatory, and may affect the values observed by [[timing independent code]].</p>
<div class="ulist">
<ul>
<li>
<p>Such architectural CMOs are guaranteed not to be performed beyond the range of microarchitecture entry numbers specified (?? TBD: is this possible, if cache line size is very ??)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Security timing channel related CMOs are mandatory but do not affect the values observed by [[timing independent code]].
POR: it is permitted for any non-value changing operations to apply beyond the range.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
there is much disagreement with respect to terminology, whether
operations that directly affect values (such as [[DISCARD cache
line]]) are to be considered CMOs at all, or whether they might be
specified by the CMO instructions such as CMO.UR. For the purposes of
this discussion we will assume that they could be specified by these
instructions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_possible_implementations_ranging_from_cache_line_at_a_time_to_whole_cache">3.2.3. Possible implementations ranging from cache line at a time to whole cache</h4>
<div class="paragraph">
<p>The CMO.UR instruction family permits implementations that include</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>operating a cache line at a time</p>
</li>
<li>
<p>trapping and emulating (e.g. in M-mode)</p>
</li>
<li>
<p>HW state machines that can operate on the full range</p>
<div class="ulist">
<ul>
<li>
<p>albeit stopping at the first page fault or exception.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>First: Cache line at a time implementations using (set,way) are typical of many other ISAs, RISC and otherwise.</p>
</div>
<div class="paragraph">
<p>Second: On some implementations the actual cache management interface is
non-standard, e.g. containing sequences of CSRs or MMIO accesses to control
external caches. Such implementations may trap the CMO instruction,
and emulate it using the idiosyncratic mechanisms.
Such trap and emulation would have high performance cost if performed a cache line at a time.
Hence, the address range semantics.</p>
</div>
<div class="paragraph">
<p>Third: While hardware state machines have some advantages, it is not
acceptable to block interrupts for a long time while cache flushes are
applied to every cache line in address range. Furthermore, address range CMOs
may be subject to address related exceptions such as page-faults and debug breakpoints.
The definition of this instruction permits state machine implementations that are [[restartable after partial completion]].</p>
</div>
<div class="sect4">
<h5 id="_sourcedest_to_support_exception_transparency_2">[[Source/dest]] to support [[exception transparency]]</h5>
<div class="paragraph">
<p>This instruction family is [[restartable after partial completion]]. E.g. on an exception such as a page fault or debug address breakpoint the output register RD is set to the data address of the exception,
and since the instruction is [[source/dest]], with the register numbers in RD and RS1 required to be the same, returning from the exception to the CMO.UR instruction will pick up execution where it left off.</p>
</div>
<div class="paragraph">
<p>RATIONALE: This proposal has chosen to implement [[source/dest]] by requiring separate register fields RD and RS1 to contain the same value. An alternative was to make register field RD both an input and an output, allowing RS1 and RS2 to be used for other inputs. Separate RD=RS1 source/dest is more natural for a RISC instruction decoder, and detecting RD=RS1 has already been performed for other RISC-V instructions, e.g. in the V extension. However separate RD=RS1 "wastes" instruction encodings by making RD!=RS1 illegal,, and leaves no register free for any 3rd operand such as the CMO type, hence requiring .&lt;cmo-specifier&gt; in the instruction encoding.</p>
</div>
<div class="paragraph">
<p>TBD: see [[who cares about RD=RS1 source/dest?]]</p>
</div>
<div class="paragraph">
<p><mark>#</mark>[[Actual CMO Operations]]</p>
</div>
</div>
<div class="sect4">
<h5 id="_discussion">Discussion</h5>
<div class="paragraph">
<p>The software loop around the CMO range instructions is required only to support cache line at a time implementations.
If this proposal only wanted to support hardware state machines or trap and emulate, the software loop would not be needed.</p>
</div>
<div class="paragraph">
<p>Although some CMOs may be optional or advisory, that refers to their effect upon memory or cache.
The range oriented CMOs like CMO.UR cannot simply be made into NOPs, because the loops above would never terminate.
The cache management operation may be dropped or ignored,
But RD must be set in such a way that the sequence beginning with zeros will eventually touch all cache lines necessary and terminate with -1. (TBD: link the text above.)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_exceptions_2">3.2.4. Exceptions</h4>
<div class="ulist">
<ul>
<li>
<p>Illegal Instruction Exceptions: taken, if the CMO.UR.&lt;cmo-specifier&gt; is not supported.</p>
</li>
<li>
<p>Permission Exception: for CMO not permitted</p>
<div class="ulist">
<ul>
<li>
<p>Certain CMO (Cache Management Operations) may be permitted to a high privilege level such as M-mode, but may be forbidden to lower privilege lebels such as S-mode or U-mode.</p>
</li>
<li>
<p>TBD: exactly how this is reported. Probably like a read/write permission exception. Possibly requiring a new exception because identifier</p>
</li>
</ul>
</div>
</li>
<li>
<p>Page Faults:</p>
<div class="ulist">
<ul>
<li>
<p>most cache hierarchies cannot receive page-faults on CMO.UR instructions, since the virtual the physical address translation has been performed before the data has been placed in the cache</p>
</li>
<li>
<p>however, there do exist microarchitectures (not necessarily RISC-V microarchitectures as of the time of writing)
whose caches use virtual addresses, and which perform the virtual the physical address translation on eviction from the cache</p>
<div class="ulist">
<ul>
<li>
<p>such implementations <em>might</em> receive page-faults, e.g. evicting dirty data for which there is no longer a valid virtual to physical translation in TLB or page table</p>
</li>
<li>
<p>although we recommend that system SW on such systems arrange so that dirty data is flushed before translations are invalidated</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Other memory permissions exceptions (e.g. PMP violations): taken</p>
</li>
<li>
<p>Debug exceptions, e.g. data address breakpoints: taken.</p>
</li>
<li>
<p>ECC and other machine checks: taken</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ecc_and_other_machine_check_exceptions_during_cmos_2">3.2.5. ECC and other machine check exceptions during CMOs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
the term "machine check" refers to an error reporting mechanism for errors such as ECC or lockstep execution mismatches. TBD: determine and use the appropriate RISC-V terminology for "machine checks".
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Machine checks may be reported as exceptions or recorded in logging registers or counters without producing exceptions.</p>
</div>
<div class="paragraph">
<p>In general, machine checks should be reported if enabled and if an error is detected that might produce loss of data. This consideration applies to CMOs: e.g. if a CMO tries to flush a dirty cache line that contains an uncorrectable error, a machine check should be reported.
However, an uncorrectable error in a clean cache line may be ignorable since it is about to be invalidated and will never be used in the future.</p>
</div>
<div class="paragraph">
<p>Similarly, a DISCARD cache line CMO may invalidate dirty cache line data without writing it back. In which case, even an uncorrectable error might be ignored, or might be reported without causing an exception.</p>
</div>
<div class="paragraph">
<p>Such machine check behavior is implementation dependent.</p>
</div>
</div>
<div class="sect3">
<h4 id="_permissions_for_cmos_2">3.2.6. Permissions for CMOs</h4>
<div class="sect4">
<h5 id="_memory_address_based_permissions_for_cmos_2">Memory address based permissions for CMOs</h5>
<div class="paragraph">
<p>Most CMO.UR.&lt;&gt; implementations do not need to use address based permissions.
CMO.UR for the most part are controlled by [[Permissions by CMO type]].</p>
</div>
<div class="paragraph">
<p>Special cases for memory address based permissions for CMO.UR include:</p>
</div>
<div class="paragraph">
<p>E.g. virtual address translation permissions</p>
</div>
<div class="ulist">
<ul>
<li>
<p>do not apply to most implementations</p>
</li>
<li>
<p>might apply to implementations that perform page table lookup when evicting dirty data from the cache.</p>
<div class="ulist">
<ul>
<li>
<p>are not required to invalidate cache lines in such implementations</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>E.g. PMP based permissions</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TBD: what should be done if CMO.UR is evicting a dirty line a memory region whose PMP indicates not writable in the current mode?</p>
<div class="ulist">
<ul>
<li>
<p>this may be implementation specific</p>
</li>
<li>
<p>most implementations will allow this</p>
<div class="ulist">
<ul>
<li>
<p>assuming that privileged SW will have flushed the cache
before entering the less privilege mode
in order to prevent any problems that might arise
(e.g. physical DRAM bank switching)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_permissions_by_cmo_type_2">[[Permissions by CMO type]]</h5>
<div class="paragraph">
<p>See section [[Permissions by CMO type]]
which applies to both address range CMO.UR.&lt;cmo-specifier&gt; and microarchitecture entry range CMO.UR.&lt;cmo-specifier&gt;
CMOs, as well as to [[Fixed Block Size CMOs]].</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_caches_and_cmo_ur">3.2.7. Multiple Caches and CMO.UR</h4>
<div class="paragraph">
<p>Cache management operations may affect multiple caches in a system. E.g. flushing data from a shared L2 may invalidate data in multiple processors' L1 I and D-caches, in addition to writing back dirty data from the L2, while traversing and invalidating an L3 before eventually being sent to memory. However, often the invalidation of multiple peer caches, the L1 I and D caches, is accomplished by cache inclusion mechanisms such as backwards and validate.</p>
</div>
<div class="paragraph">
<p>However, sometimes it is necessary to flush multiple caches without relying on hardware coherence cache inclusion. This could be achieved by mapping several different caches&#8217;s (set,way) or other physical location into the same microarchitecture entry number space. However, this is by no means required</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cmo_descriptor_what_is_affected">3.3. [[CMO descriptor]] - what is affected</h3>
<div class="paragraph">
<p>See [[CMO descriptor]] for an explanation of how the CMO instructions, and this instruction CMO.UR in particular, specify which caches and branch predictors and other microarchitecture state should be managed.</p>
</div>
<div class="paragraph">
<p>Suffice it to say that a single CMO.UR instruction is able to perform invalidations and/or cache flushes of multiple caches in the same CMO.UR loop construct. This is accomplished by the [[CMO UR descriptor operand]]</p>
</div>
</div>
<div class="sect2">
<h3 id="_cmo_ur_index">3.4. [[CMO UR index]]</h3>
<div class="sect3">
<h4 id="_traditional_microarchitecture_cache_invalidation_loops_in_the_past">3.4.1. Traditional microarchitecture cache invalidation loops in the past</h4>
<div class="paragraph">
<p>Many computer architectures can invalidate a cache in time proportional to the number of entries within the cache using a code construct that looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   FOR S OVER ALL sets in cache C
      FOR W OVER ALL ways in cache C
           INVALIDATE (cache C, set S, way W)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that not all microarchitecture data structures have the associative (set,way) structure. We might generalize the above as</p>
</div>
<div class="listingblock">
<div class="content">
<pre> FOR E OVER ALL entries in hardware data structure HDS
     INVALIDATE (hardware data structure HDS, entry E)</pre>
</div>
</div>
<div class="paragraph">
<p>If multiple hardware data structures need to be flushed or invalidated one might do something like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  FOR H OVER ALL hardware data structures that we wish to invalidate
    FOR E OVER ALL entries in hardware data structure HDS
       INVALIDATE (hardware data structure H, entry E)</pre>
</div>
</div>
<div class="paragraph">
<p>Without loss of generality we will assume that if a hardware data structure has an O(1) bulk invalidate, that it is handle as above, e.g. that the "entry" for the purposes of invalidation will be the entire hardware data structure.  Similarly, some hardware data structures might invalidate for entries, e.g. all of the lines in a cache set, at once.</p>
</div>
<div class="paragraph">
<p>Portable code might be able to determine what hardware data structures it needs to invalidate by inspecting a [[system description such as CPUID or config string]]. However, it may be necessary to invalidate the hardware data structures e.g. caches in a particular order. E.g. on a system with no cache coherence, not even hierarchical, it may be necessary to flush dirty data first from the L1 to the L2, then from the L2 to the L3, &#8230;&#8203; ultimately to memory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cmo_ur_abstracts_and_unifies_microarchitecture_cache_invalidation_loops">3.4.2. CMO.UR abstracts and unifies microarchitecture cache invalidation loops</h4>
<div class="paragraph">
<p>CMO.UR and the [[CMO UR index]] abstract such microarchitecture dependencies as follows:</p>
</div>
<div class="paragraph">
<p>There is no need to loop over various caches and other hardware data structures.  The [[CMO.UR loop construct]] loops over all hardware data structures and all entries in those hardware data structures as needed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   reg_for_cmo_index := 0   // maximum positive signed integer
   LOOP
      CMO.UR RD:reg_for_cmo_index, RS1:reg_for_cmo_handle
   UNTIL reg_for_cmo_index &lt; 0</pre>
</div>
</div>
<div class="paragraph">
<p>For any particular CMO (as specified by a [[CMO descriptor]]) all of the various hardware data structures, caches are combined into the same [[CMO UR index]] space, which is a subset of the positive integers of length XLEN.</p>
</div>
<div class="paragraph">
<p>TBD: move this example into a separate page.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CMO UR index</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1&lt;&lt;(XLEN-1)-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum positive integer, RD input value at start of CMO loop construct</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unused - CMO.UR skips over</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong> L2$ </strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16-way 64M L2 D$ / 64B lines =&gt; 2^20 = 1M entries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1FFFFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2$ entry #1M-1, i.e. set #16K-1, way #15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; other L2$ entries &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2$ entry #0, i.e. set #0, way #0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unused - CMO.UR skips over</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong> L1 D$ </strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-way 32K L1 D$ / 64B lines =&gt; 2^9 = 512 entries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21FF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D$ entry #511, i.e. set #63, way #7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; other D$ entries &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D$ entry #1, i.e. set #0, way #1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D$ entry #0, i.e. set #0, way #0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unused - CMO.UR skips over</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong> L1 I$ </strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-way 16K L1 I$ / 64B lines =&gt; 2^8 = 256 entries 1000H</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10FF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I$ entry #255, i.e. set #63, way #3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; other I$ entries &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I$ entry #1, i.e. set #0, way #1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I$ entry #0, i.e. set #0, way #0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unused - CMO.UR skips over</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">final value if CMO.UR completes successfully</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved for error reporting</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>I.e. each hardware data structure is allocated a range of indexes in the [[CMO UR index]] space. The [[CMO.UR loop construct]] loops over the indexes from largest possible to smallest. Therefore, the order of the flushes or invalidations is implied by the index range allocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>   reg_for_cmo_index := 0
   LOOP
      CMO.UR RD:reg_for_cmo_index, RS1:reg_for_cmo_handle
   UNTIL reg_for_cmo_index &lt; 0</pre>
</div>
</div>
<div class="paragraph">
<p>The mapping of hardware data structures and their entries into the [[CMO UR index]] space is microarchitecture and implementation specific. Portable software should not rely on any such mapping.</p>
</div>
<div class="paragraph">
<p>The invalidation or flushes desired by any particular cache management operation, as specified by its [[CMO descriptor]], will probably not involve touching all possible [[CMO UR index]].  Therefore, the [[CMO UR index]] traversal for any particular [[CMO descriptor]] may skip - e.g. in the above example, if one desires only to invalidate the instruction cache, one would skip the ranges for the L2 in the L1 data cache. An alternate implementation would be to create a different mappings of CMO UR indexes to hardware data structure entries for different CMOs.</p>
</div>
<div class="paragraph">
<p>At the very least, CMO.UR will skip from the starting value 1&lt;&lt;(XLEN-1)-1 to the largest [[CMO UR index]] value defined for the requested operation. It is also expected to skip CMO UR index values when the hardware data structures are not allocated contiguously within the CMO UR index space.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cmo_ur_indexes_should_not_be_created_out_of_thin_air">3.5. CMO UR indexes should not be created out of thin air</h3>
<div class="paragraph">
<p>Software invoking CMO.UR should not create arbitrary CMO UR indexes "out of thin air".</p>
</div>
<div class="paragraph">
<p>The index values should only be as obtained from the [[CMO.UR loop construct]]</p>
</div>
<div class="paragraph">
<p>reg_for_cmo_index := 1&lt;&lt;(XLEN-1) - 1   // maximum positive signed integer
   LOOP
      CMO.UR RD:reg_for_cmo_index, RS1:reg_for_cmo_handle
   UNTIL reg_for_cmo_index &lt;= 0</p>
</div>
<div class="paragraph">
<p>Invoking CMO.UR with input register (RD) index values that were not as obtained from the sequence above is undefined.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Obviously, if invoked from user code there must be no security flaw. Similarly, if executed by a guest OS on top of a hypervisor.</p>
</li>
<li>
<p>It is permissible for an implementation to ignore CMO UR index values that are incompatible with the [[CMO descriptor]]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the software executing the [[CMO loop construct]] performs its own skipping of CMO UR indexes, the effect is undefined (although obviously required to remain secure).  In particular, it cannot be guaranteed that any or all of the work required to be done by the [[CMO.UR loop construct]] will have been completed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
the loop construct can be interrupted and restarted from scratch. There is no requirement that the loop construct be completed.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A thread might migrate from one CPU to another while the CMO loop construct is in progress. If this is done it is the responsibility of the system performing the migration to ensure that the desired semantics are obtained. For example, the code that is being migrated might be restricted to only apply to cache levels common to all processors migrated across. Or similarly the runtime performing the migration might be required to ensure that all necessary caches are consistent. [[(see issue)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISSUE: process migration argues for whole cache invalidation operations and against the partial progress loop construct]].</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>ISSUE: should it be legal for software to save the indexes from a first traversal of this loop and replay them later?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Certainly not if the operation as specified by the [[CMO descriptor]] is different from that for which the indexes were obtained.</p>
</li>
<li>
<p>I would like to make it illegal overall, but I can&#8217;t CNP practical way to do this.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_errors_during_cmo_ur">3.6. Errors during CMO.UR</h3>
<div class="paragraph">
<p>CMO.UR&#8217;s output register RD is set to zero on successful completion of the operation.</p>
</div>
<div class="paragraph">
<p>Negative values for CMO.UR&#8217;s output register RD are reserved to indicate possible errors. At this point in time (Monday, January 27, 2020-01-27), no such errors are defined. Any errors encountered while performing CMO.UR (e.g. on correctable errors in a cache tag) should be reported using normal [[RISC-V hardware error reporting]] mechanisms (e.g. [[machine check]] exceptions).</p>
</div>
<div class="paragraph">
<p>Rationale: it is probably best for CMO.UR to use normal [[RISC-V hardware error reporting]] mechanisms, such as immediate and/or deferred machine check exceptions, and/or recording error status in CSRs.  However, it is possible that some CMOs may be used in situations where normal error reporting is either not available or is inconvenient. It is straightforward to reserve negative values to indicate possible errors when the instruction is created. It would not be possible to retroactively change the definition of the CMO.UR instruction to do such error reporting if there were no such reserved values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
unfortunately, such error reporting can not be performed for the memory address range based CMOs, CMO.UR, since there RD return value can assume all permissible values as it is an excellent address.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_privilege_for_cmos">4. Privilege for CMOs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_summary_privilege_for_cmos_and_prefetches">4.1. SUMMARY: Privilege for CMOs and Prefetches</h3>
<div class="paragraph">
<p>Each of the prefetches and CMOs,
including the fixed block size prefetches PREFETCH.64B.*
and CMOs CMO.64B.<strong>,
and the address range CMOs CMO.VR.</strong>
and cache index CMOs CMO.UR.*
are mapped to a number 0..Ncmo-1, where Ncmo is the Number of CMO instruction  encodings.</p>
</div>
<div class="paragraph">
<p>(Note:  the encodings do not necessarily have a contiguous field that corresponds to these values.)</p>
</div>
<div class="paragraph">
<p>CSR <a href="CMO-Privilege" class="bare">CMO-Privilege</a> contains Ncmo 2-bit fields where bitfield CMO_Privilege.2b[J] indicates the privilege required to perform the corresponding CMO operation J.</p>
</div>
<div class="paragraph">
<p>The 2-bit fields are encoded as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>00 &#8658;  disabled.</p>
</li>
<li>
<p>01 &#8658; traps to M mode</p>
<div class="ulist">
<ul>
<li>
<p>TBD: exception info (cause, address)</p>
</li>
</ul>
</div>
</li>
<li>
<p>10 &#8658; reserved</p>
</li>
<li>
<p>11 &#8658; can execute in any mode, including user mode</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The disabled behavior is as follows:</p>
</div>
<div class="paragraph">
<p>CMO_Privilege.2[J] &#8658; CMO.#J</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the  instruction does not actually perform any cache maintenance operation.</p>
</li>
<li>
<p>but it returns a value such that the [[canonical range CMO loop]] exits</p>
</li>
<li>
<p>CMO.VR rd:next_addr, rs1=rd:start_addr, rs2:stop_addr</p>
</li>
<li>
<p>sets RD to stop_addr</p>
</li>
<li>
<p>CMO.UR rd:next_entry, rs1:start_entry</p>
</li>
<li>
<p>sets RD to -1</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_rationale_privilege_for_cmos_and_prefetches">4.2. RATIONALE: Privilege for CMOs and Prefetches</h3>
<div class="paragraph">
<p>Requirement:  in some CPU implementations  all or some CMOs <strong>must</strong> be trapped to M-mode and emulated.  E.g. caches that  require MMIOs or CSR actions to flush,  which are not directly connected to</p>
</div>
<div class="paragraph">
<p>Requirement:  in some platform configurations some CMOs may <strong>optionally</strong> be trapped to M-mode and emulated. E.g. [[CMOs involving idiosyncratic external caches and devices]],  devices that use MMIOs or CSRs  to perform CMOs,  and which are not (yet?)  directly connected to whatever</p>
</div>
<div class="paragraph">
<p>Requirement: it  is highly desirable to  be able to perform CMOs in user mode. E.g. for performance. But also for security,  persistence,   since everywhere the [[Principle of Least Privilege]]   should apply:  e.g.  the cache management may be performed by a privileged user process, i.e. a process that is part of the operating system but which is running at reduced privilege.   In  such a system the operating system or hypervisor may choose to context switch the CSR_Privilege CSR, or  bitfields therein.</p>
</div>
<div class="paragraph">
<p>Requirement:  even though it is highly desirable to be able to perform CMOs in user mode, in some situations allowing arbitrary user mode code to perform CMOs is a security vulnerability.  vulnerability possibilities include:  information leaks, denial of service, and facilitating RowHammer attacks.</p>
</div>
<div class="paragraph">
<p>Requirement: many CMOs  should be permitted to user code, e.g. flush dirty data,  since they do nothing that  user code cannot itself do  using ordinary load and store instructions.   Such CMOs are typically advisory or performance related.   note that doing this using ordinary load and store instructions might require detailed microarchitecture knowledge,  or might be unreliable in the presence of speculation that can affect things like LRU bits.</p>
</div>
<div class="paragraph">
<p>Requirement: some CMOs should <strong>not</strong>  be permitted to user code. E.g. discard or forget  dirty data without writing it back. This is  a security vulnerability in most situations. (But not all -  although the situations in which it is not a security vulnerability are quite rare, e.g. certain varieties of supercomputers, although possibly also privileged software,  parts of the OS, running in user mode.)</p>
</div>
<div class="paragraph">
<p>Requirement:  some CMOs may usefully be disabled.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Typically performance related CMOs, such as flushing to a shared cache level, or prefetching using the range CMOs Software is notorious for thinking that it knows the best thing to do,</p>
</li>
<li>
<p>Also  possibly software based on assumptions  that do not apply to the current system</p>
</li>
<li>
<p>e.g. system software may be written so that it can work with incoherent MMIO
but may be running on a system that has coherent MMIO</p>
</li>
<li>
<p>e.g.  persistence software written so that it can work with limited nonvolatile storage
running on a system where all memory is nonvolatile</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Requirement: Sometimes there needs to be a mapping between  the CMO that a user wants and the CMOs that hardware provides,  where the mapping is not known to CPU hardware,  not known to user code, but depends on the operating system and/or runtime, and might &lt;i&gt;dynamically&lt;/i&gt; depend on the operating system and/or runtime.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>e.g. For performance related CMOs, the user may only know that she wants to flush whatever caches are smaller than a particular size like 32K.  The user does not know which caches those  are on a particular system.</p>
</li>
<li>
<p>e.g. in software coherence all dirty data written by the sending process P_producer  may need to be flushed to a shared cache level so that it can be read by the consuming process P_consumer</p>
</li>
<li>
<p>consider if the sending process P_producer is part of a HW coherent  cache consistency domain,  but the receiving process P_consumer is  part of a different such domain</p>
</li>
<li>
<p>if the hardware cache  consistency domain  permits cache-to-cache  migration of dirty data, then all  caches in that  dirty domain  be flushed.</p>
</li>
<li>
<p>however,  if the hardware cache consistency domain does NOT permit cache-to-cache migration, then</p>
</li>
<li>
<p>if the system software  performs thread or process migration between CPUs that do not share caches</p>
</li>
<li>
<p>without cache flushes &#8658; THEN  this SW dirty domain must be flushed</p>
</li>
<li>
<p>but if the system software performs cache flushes  on thread migration,
&#8658; THEN only the local processor cache need be flushed.</p>
</li>
<li>
<p>if the system software does not perform thread or process migration,  t
hen only the local processor cache be flushed.
Other processor caches in the HW clean consistency domain do not need to be flushed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optionally trapping  such CMOs allows the system or runtime software to choose the most appropriate  hardware CMO for the users' need.</p>
</div>
<div class="paragraph">
<p><strong>I.e. the mapping is done by SW in the trap handler</strong></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2">.</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_techpubs_information">Appendix A: Techpubs Information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Note: paths local to system document generated on are mostly meaningless to others,
but have already been helpful finding source for orphaned PDF arafnd HTML.</p>
</div>
<div class="paragraph">
<p>This source document: Ri5-CMOs-proposal.asciidoc</p>
</div>
<div class="ulist">
<ul>
<li>
<p>docdatetime:  2020-05-14 11:39:00 -0700 - last modified date and time</p>
</li>
<li>
<p>docfile:  /cygdrive/c/Users/glew/Documents/GitHub/Ri5-stuff/Ri5-stuff.wiki/Ri5-CMOs-proposal.asciidoc - full path</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When and where converted (i.e. when asciidoctor was run, to generate this file):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>localdatetime:  2020-05-14 12:44:32 -0700</p>
</li>
<li>
<p>outfile:  /cygdrive/c/Users/glew/Documents/GitHub/Ri5-stuff/Ri5-stuff.wiki/Ri5-CMOs-proposal.html - full path of the output file</p>
</li>
<li>
<p>TBD: what system (PC, Linux system) was asciidoctor run on?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Revisions - manually maintained, frequently obsolete:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>revdate: + Privilege for CMOs&#8230;&#8203;</p>
</li>
<li>
<p>revnumber: 0.1: Fixed Block Prefetches + CMOs</p>
</li>
<li>
<p>revremark: {revremark}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More techpubs information, including history thrashing as to how and where to build and store, on wiki page
<a href="techpubs" class="bare">techpubs</a>
<a href="file:techpubs.asciidoc" class="bare">file:techpubs.asciidoc</a>
(TBD: fix so that works both checked out as file: klinks and on GitHub wiki).</p>
</div>
<div class="paragraph">
<p>Generated files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TBD: need to create conditional links that direct to different places based on viewing environment</p>
<div class="ulist">
<ul>
<li>
<p>until then &#8230;&#8203;</p>
</li>
</ul>
</div>
</li>
<li>
<p>local where built:</p>
<div class="ulist">
<ul>
<li>
<p>won&#8217;t work from web</p>
</li>
<li>
<p><a href="file:Ri5-CMOs-proposal.html" class="bare">file:Ri5-CMOs-proposal.html</a></p>
</li>
<li>
<p><a href="file:Ri5-CMOs-proposal.pdf" class="bare">file:Ri5-CMOs-proposal.pdf</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>GitHub:</p>
<div class="ulist">
<ul>
<li>
<p>note: inconsistent unless viewed on web</p>
</li>
<li>
<p><a href="https://github.com/AndyGlew/Ri5-stuff/" class="bare">https://github.com/AndyGlew/Ri5-stuff/</a></p>
<div class="ulist">
<ul>
<li>
<p>HTML: <a href="https://github.com/AndyGlew/Ri5-stuff/blob/master/Ri5-CMOs-proposal.html" class="bare">https://github.com/AndyGlew/Ri5-stuff/blob/master/Ri5-CMOs-proposal.html</a></p>
<div class="ulist">
<ul>
<li>
<p>displays raw, does not render</p>
</li>
</ul>
</div>
</li>
<li>
<p>PDF: <a href="https://github.com/AndyGlew/Ri5-stuff/blob/master/Ri5-CMOs-proposal.pdf" class="bare">https://github.com/AndyGlew/Ri5-stuff/blob/master/Ri5-CMOs-proposal.pdf</a></p>
<div class="ulist">
<ul>
<li>
<p>displays - in GitHub&#8217;s ugly way</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://github.com/AndyGlew/Ri5-stuff/wiki" class="bare">https://github.com/AndyGlew/Ri5-stuff/wiki</a></p>
<div class="ulist">
<ul>
<li>
<p>PDF: <a href="https://github.com/AndyGlew/Ri5-stuff/wiki/Ri5-CMOs-proposal.pdf" class="bare">https://github.com/AndyGlew/Ri5-stuff/wiki/Ri5-CMOs-proposal.pdf</a></p>
<div class="ulist">
<ul>
<li>
<p>downloads, does not display</p>
</li>
</ul>
</div>
</li>
<li>
<p>HTML: <a href="https://github.com/AndyGlew/Ri5-stuff/wiki/Ri5-CMOs-proposal.html" class="bare">https://github.com/AndyGlew/Ri5-stuff/wiki/Ri5-CMOs-proposal.html</a></p>
<div class="ulist">
<ul>
<li>
<p>displays raw, not HTML</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.1: Fixed Block Prefetches + CMOs<br>
Last updated 2020-05-14 11:39:00 -0700
</div>
</div>
</body>
</html>